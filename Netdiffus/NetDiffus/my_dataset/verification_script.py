import pandas as pd
import numpy as np
import matplotlib.pyplot as plt
from pathlib import Path

def load_trace(trace_path):
    """
    Loads a trace from a CSV file.
    """
    return pd.read_csv(trace_path, header=None).values.flatten()

def compare_traces(your_trace_path, actual_trace_path):
    """
    Compare the trace generated by your script with the trace from the 'actual' folder.
    """
    # Load the traces
    your_trace = load_trace(your_trace_path)
    actual_trace = load_trace(actual_trace_path)
    
    # Verify that they have the same length
    if len(your_trace) != len(actual_trace):
        print(f"Mismatch in trace lengths: Your trace = {len(your_trace)}, Actual trace = {len(actual_trace)}")
        return
    
    # Calculate mean and standard deviation
    your_mean = np.mean(your_trace)
    your_std = np.std(your_trace)
    actual_mean = np.mean(actual_trace)
    actual_std = np.std(actual_trace)
    
    print(f"Your Trace - Mean: {your_mean}, Std Dev: {your_std}")
    print(f"Actual Trace - Mean: {actual_mean}, Std Dev: {actual_std}")
    
    # Calculate the correlation coefficient
    correlation = np.corrcoef(your_trace, actual_trace)[0, 1]
    print(f"Correlation Coefficient: {correlation}")
    
    # Plot histograms to visualize distributions
    plt.figure(figsize=(10, 5))
    plt.hist(your_trace, bins=50, alpha=0.5, label='Your Trace', color='blue')
    plt.hist(actual_trace, bins=50, alpha=0.5, label='Actual Trace', color='orange')
    plt.xlabel('Pixel Intensity')
    plt.ylabel('Frequency')
    plt.title('Histogram Comparison')
    plt.legend()
    plt.show()
    
    # Plot the two traces side by side for visual comparison
    plt.figure(figsize=(10, 5))
    plt.subplot(1, 2, 1)
    plt.imshow(your_trace.reshape(128, 128), cmap='gray')
    plt.title('Your Trace')
    
    plt.subplot(1, 2, 2)
    plt.imshow(actual_trace.reshape(128, 128), cmap='gray')
    plt.title('Actual Trace')
    
    plt.show()

if __name__ == "__main__":
    # Paths to your generated trace and the actual trace from the folder
    your_trace_path = Path(r'C:\Users\stava\Deep\output\trace_1.csv')  # Updated path to your generated trace
    actual_trace_path = Path(r'C:\Users\stava\NetDiffus\DF\DF\traces_80\actual\deepfp_vid1_1.csv')  # Updated path to the actual trace
    
    compare_traces(your_trace_path, actual_trace_path)
